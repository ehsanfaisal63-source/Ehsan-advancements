{
  "entities": {
    "Project": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Project",
      "type": "object",
      "description": "Represents a user-created project.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the project."
        },
        "name": {
          "type": "string",
          "description": "The name of the project."
        },
        "description": {
          "type": "string",
          "description": "A description of the project."
        },
        "status": {
          "type": "string",
          "description": "The current status of the project.",
          "enum": ["Not Started", "In Progress", "Completed"]
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the project was created.",
          "format": "date-time"
        }
      },
      "required": ["id", "name", "status", "createdAt"]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "User's display name."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile photo.",
          "format": "uri"
        },
        "creationTime": {
          "type": "string",
          "description": "Timestamp of when the user profile was created.",
          "format": "date-time"
        },
        "lastSignInTime": {
          "type": "string",
          "description": "Timestamp of the user's last sign-in.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "displayName"
      ]
    },
    "AuthorizationDomain": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AuthorizationDomain",
      "type": "object",
      "description": "Represents an authorized domain for Google authentication.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the authorization domain."
        },
        "domain": {
          "type": "string",
          "description": "The authorized domain URL."
        },
        "creationTime": {
          "type": "string",
          "description": "Timestamp of when the authorization domain was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "domain"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}/projects/{projectId}",
        "definition": {
          "entityName": "Project",
          "schema": {
            "$ref": "#/backend/entities/Project"
          },
          "description": "Stores user-specific projects. Only the authenticated user can access their own projects.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, from Firebase Auth (request.auth.uid)."
            },
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Only the authenticated user can access their own profile. Includes standard Firebase user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, obtained from Firebase Authentication (request.auth.uid)."
            }
          ]
        }
      },
      {
        "path": "/authorizationDomains/{authorizationDomainId}",
        "definition": {
          "entityName": "AuthorizationDomain",
          "schema": {
            "$ref": "#/backend/entities/AuthorizationDomain"
          },
          "description": "Stores authorized domains for Google authentication. Access restricted to admins. Includes domain and creation time.",
          "params": [
            {
              "name": "authorizationDomainId",
              "description": "The unique identifier for the authorization domain."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "role_admin",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Documents in this collection represent users with admin roles. Existence of a document for a user indicates admin privileges.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to be secure, scalable, and easily debuggable, adhering to the core principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters). Authorization Independence is achieved through denormalization, avoiding `get()` calls in security rules. Structural Segregation ensures that collections contain documents with homogeneous security postures. Access Modeling follows consistent patterns for authorization using path-based ownership and membership maps. Data Clarity and Predictability are maintained through explicit state modeling, predictable schema, and radical consistency in naming conventions.\n\nSpecifically:\n\n*   User profiles are stored under `/users/{userId}`, ensuring that only the authenticated user can access their profile data. Authorization is inherent in the path structure.\n*   Authorization domains are stored in the `/authorizationDomains/{authorizationDomainId}` collection. Access to this collection is restricted based on global role via the existence of `/roles_admin/{uid}`.\n\nThis structure supports QAPs by:\n\n*   Segregating data with different access needs into separate collections (e.g., user profiles vs. authorization domains).\n*   Using path-based ownership for user profiles enabling secure `list` operations within a user's scope.\n"
  }
}
